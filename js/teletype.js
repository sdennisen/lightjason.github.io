"use strict";(function(){var a="teletype";jQuery.fn[a]=function(l){var m=this.data("plugin_"+a);if(!m){m=new i(this,jQuery.extend({},jQuery.fn[a].defaultSettings,l||{}));this.data("plugin_"+a,m)}return m};jQuery.fn[a].defaultSettings={text:[],result:[],automaticstart:true,classresult:"teletype-result",classprefix:"teletype-prefix",classcursor:"teletype-cursor",classoutput:"teletype-text",taglinebreak:"<br/>",typeDelay:120,backDelay:180,blinkSpeed:1000,cursor:"|",prefix:"",loop:1,humanise:true,smoothBlink:true,callbackNext:null,callbackType:null,vallbackBackward:null,callbackFinished:null,callbackStart:null,callbackReset:null,callbackNextLoop:null};function i(m,l){this.dom=m;this.settings=l;return c(this)}i.prototype={cursor:function(l){this.settings.cursor=l;this.dom.find("."+this.settings.classcursor+":first").html(this.settings.cursor);return this},reset:function(){if(this.settings.loop===0){return this}b(g(this.stop().empty()));if(typeof(this.settings.callbackReset)==="function"){this.settings.callbackReset(this)}return this},empty:function(){this.dom.find("."+this.settings.classoutput+":first").empty();return this},stop:function(){if(this.current.timeout){clearTimeout(this.current.timeout)}return this},start:function(){if(this.settings.automaticstart){return this}b(this);if(typeof(this.settings.callbackStart)==="function"){this.settings.callbackStart(this)}h(this);return this}};var b=function(l){if((!l.settings.text)||(l.settings.text.length===0)){return l}l.current.string=l.settings.text[l.current.index].replace(/\n/g,"\\n");l.current.letters=l.current.string.split("");l.current.result=((l.settings.result.length===l.settings.text.length)&&(l.settings.result[l.current.index]))?'<p class="'+l.settings.classresult+'">'+l.settings.result[l.current.index]+"</p>":"";return l};var g=function(l){l.current={string:"",result:"",letters:[],index:0,position:0,loop:0,timeout:null};return l};var d=function(m,l){return m.settings.humanise?Math.round(parseInt(l)+Math.random()*l/3):parseInt(l)};var k=function(m,n){var l=m.substr(n).search(/[^0-9]/);return m.substr(n,l===-1?m.length:l)};var j=function(m,n){var l=k(m.current.string,n);if(!jQuery.isNumeric(l)){return m}m.current.position=n+l.length;m.current.timeout=setTimeout(h(m),l);return m};var e=function(l){l.current.index+=1;if(l.current.index>=l.settings.text.length){l.current.index=0;l.current.loop+=1;if(typeof(l.settings.callbackNextLoop)==="function"){l.settings.callbackNextLoop(l)}if((l.settings.loop!==false)&&(l.settings.loop===l.current.loop)){if(typeof(l.settings.callbackFinished)==="function"){l.settings.callbackFinished(l)}return false}}b(l);l.current.position=0;if(typeof(l.settings.callbackNext)==="function"){l.settings.callbackNext(l)}return true};var c=function(m){m.dom.empty();g(m);m.output=jQuery("<span/>").addClass(m.settings.classoutput).appendTo(m.dom);if(m.settings.cursor){var n=jQuery("<span/>").addClass(m.settings.classcursor).appendTo(m.dom).text(m.settings.cursor);var l=m;setInterval(function(){if(l.settings.smoothBlink){n.animate({opacity:0}).animate({opacity:1})}else{n.delay(500).fadeTo(0,0).delay(500).fadeTo(0,1)}},m.settings.blinkSpeed)}if(m.settings.automaticstart){b(m);if(typeof(m.settings.callbackStart)==="function"){m.settings.callbackStart(m)}h(m)}return m};var f=function(m,l){if((l<1)||(m.current.position-l<1)){m.current.timeout=setTimeout(h(m),d(m,m.settings.typeDelay));return m}m.current.timeout=setTimeout(function(){m.output.html(m.output.html().slice(0,-1));f(m,l-1);if(typeof(m.settings.callbackBackward)==="function"){m.settings.callbackBackward(m)}},d(m,m.settings.backDelay));return m};var h=function(o){if((o.settings.prefix)&&(o.current.position===0)){jQuery("<span />").addClass(o.settings.classprefix).html(o.settings.prefix).appendTo(o.output)}var m=o.current.letters[o.current.position];var p=o.current.position+1;if(m==="^"){j(o,p);return}if(m==="~"){var n=k(o.current.string,p);if(jQuery.isNumeric(n)){var l=o;o.current.position+=n.length+1;o.current.timeout=setTimeout(function(){f(l,n)},d(o,o.settings.backDelay*n));return}}if((m==="\\")&&(o.current.string.substr(p,1)==="n")){o.current.position+=1;m=o.settings.taglinebreak}if(typeof(o.settings.callbackType)==="function"){o.settings.callbackType(o)}if(o.current.position<o.current.string.length){o.current.timeout=setTimeout(function(){o.current.position+=1;o.output.html(o.output.html()+m);h(o)},d(o,o.settings.typeDelay))}else{if(o.current.result){o.output.html(o.output.html()+o.current.result)}if(e(o)){o.output.html(o.output.html()+o.settings.taglinebreak);o.current.timeout=setTimeout(h(o),d(o,o.settings.typeDelay))}}}}(jQuery));